"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6824],{29523:function(e,t,n){n.d(t,{s:function(){return o}});var r=n(57437),i=n(2265);let o=i.memo(function(e){let{children:t,onClose:n}=e,o=(0,i.useCallback)(e=>{"Escape"===e.key&&n()},[n]);return(0,i.useEffect)(()=>(document.addEventListener("keydown",o),()=>{document.removeEventListener("keydown",o)}),[o]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"fixed inset-0 w-screen h-screen bg-black bg-opacity-70 z-50",children:(0,r.jsx)("style",{children:"\n            body {\n              overflow-y: hidden !important;\n            }\n          "})}),(0,r.jsx)("div",{onClick:()=>{n()},className:"fixed inset-0 w-screen h-screen flex items-center justify-center z-50",children:t})]})})},45866:function(e,t,n){n.d(t,{b:function(){return u},l:function(){return s}});var r=n(57437),i=n(57042),o=n(2265),a=n(35278);n(4199);var l=n(58732);let s=o.memo(function(e){let{selectedItem:t=0,onChange:n,children:i}=e,s=(0,l.iP)(),u=s.width&&s.width<768;return(0,o.useEffect)(()=>{let e=e=>{"ArrowRight"===e.key&&t<i.length-1&&n(t+1),"ArrowLeft"===e.key&&t>0&&n(t-1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[t,n,i.length]),(0,r.jsx)(a.lr,{onChange:n,selectedItem:t,axis:"horizontal",dynamicHeight:!0,showIndicators:!1,showStatus:!1,showThumbs:!1,showArrows:!1,transitionTime:u?100:0,centerMode:!1,swipeable:!0,useKeyboardArrows:!0,preventMovementUntilSwipeScrollTolerance:!0,swipeScrollTolerance:20,children:i})}),u=o.memo(function(e){let{count:t,selectedIndex:n,onSelect:o}=e;return(0,r.jsx)("div",{className:"flex space-x-2 mt-4",children:Array(t).fill("").map((e,t)=>(0,r.jsx)("div",{onClick:e=>{e.stopPropagation(),o(t)},className:(0,i.Z)({"w-2.5 h-2.5 rounded-full cursor-pointer":!0,"bg-zinc-700":t!==n,"bg-zinc-300":t===n})},t))})})},36518:function(e,t,n){n.d(t,{_:function(){return m}});var r=n(57437),i=n(2265),o=n(57042),a=n(82749),l=n(28285),s=n(54829),u=n(24033),c=n(90166),d=n(24670);let m=i.memo(function(e){let{imageWidth:t,imageId:n,eventSource:m}=e,p=(0,u.useRouter)(),{data:h}=(0,a.useSession)(),{setLoginCallbackUrl:f}=(0,d.useLogin)(),g=["likes"],v=["prompts.infinitePrompts",{source:"likes"}],y=(0,l.a)({queryKey:g,queryFn:()=>(0,s.Z)("/api/likes").then(e=>e.data),enabled:!!h,staleTime:3e5,notifyOnChangeProps:["data"],select:e=>e.includes(n)}),{mutate:w}=(0,c.n)({mutationFn:async e=>s.Z.post("/api/likes/add",e).then(e=>e.data),optimistic:e=>[{queryKey:g,updater:t=>[...t||[],e.imageId]}]}),{mutate:x}=(0,c.n)({mutationFn:async e=>s.Z.post("/api/likes/delete",e).then(e=>e.data),optimistic:e=>[{queryKey:g,updater:t=>(t||[]).filter(t=>t!==e.imageId)},{queryKey:v,updater:t=>{if(t)return{...t,pages:t.pages.map((t,n)=>({...t,images:t.images.filter(t=>t.id!==e.imageId),count:0===n&&t.count?t.count-1:0}))}}}]}),b=!!y.data,k=(0,i.useCallback)(e=>{if(e.preventDefault(),e.stopPropagation(),!h){f(),p.push("/login");return}b?x({imageId:n}):w({imageId:n,eventSource:m})},[n,m,b,w,x,h,p,f]);return(0,r.jsx)("button",{onClick:k,className:(0,o.Z)("bg-zinc-900 bg-opacity-70 hover:bg-opacity-100 flex items-center justify-center pointer-events-auto cursor-pointer active:scale-90 transition-all",{"rounded text-md h-8 w-8":t<=180,"rounded-lg text-lg h-10 w-10":t>180&&t<1e3,"rounded-lg text-lg h-11 w-11":t>=1e3}),children:(0,r.jsx)("div",{className:"scale-50",children:(0,r.jsx)("div",{className:(0,o.Z)("heart brightness-110",{"is-active":b})})})})})},25137:function(e,t,n){n.d(t,{$:function(){return o}});var r=n(57437);n(2265);var i=n(57042);let o=e=>{let{size:t="sm"}=e;return(0,r.jsxs)("div",{className:(0,i.Z)("la-ball-grid-beat",{sm:"la-sm",md:"",lg:"la-2x",xl:"la-3x"}[t]),children:[(0,r.jsx)("div",{}),(0,r.jsx)("div",{}),(0,r.jsx)("div",{})]})}},95884:function(e,t,n){function r(e){return e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||e.nativeEvent&&2===e.nativeEvent.which}n.d(t,{_S:function(){return i},gC:function(){return o},gs:function(){return r},vK:function(){return a}});let i=e=>Math.max(e,0),o=(e,t)=>Math.min(e,t),a=e=>{if(e>=3600){let t=Math.round(e/3600);return"".concat(t," hour").concat(1!==t?"s":"")}if(!(e>=60))return"".concat(e," second").concat(1!==e?"s":"");{let t=Math.round(e/60);return"".concat(t," minute").concat(1!==t?"s":"")}}},19095:function(e,t,n){n.d(t,{j:function(){return i}});var r=n(19702);function i(e,t){return{images:t.map(t=>({id:t.id,url:(0,r.Jn)({id:t.id,size:"lg",model:e.model||""}),promptid:e.id,width:t.width,height:t.height,upscaledHeight:t.upscaled_height,upscaledWidth:t.upscaled_width,userId:t.userid,isUpscale:(e.model||"").includes("aperture")&&t.width>768&&t.height>768})),prompt:{id:e.id,prompt:e.prompt||"",negativePrompt:e.negativePrompt||"",model:e.model||"stable-diffusion",guidanceScale:e.c,width:e.width,height:e.height}}}},19702:function(e,t,n){n.d(t,{Ix:function(){return a},Jn:function(){return i},tO:function(){return o}});var r=n(54829);function i(e){let t,n,{id:r,size:i,model:o,download:a,forceJpg:l}=e,s={v1:{sm:"sm",md:"md",lg:"md"},v2:{sm:"sm2",md:"md2",lg:"full"},v3:{sm:"sm2",md:"md2",lg:"full"}}[n="lexica-aperture-v3.5"===o||"lexica-aperture-v4"===o?"v3":(null==o?void 0:o.includes("aperture"))?"v2":"v1"][i];return"v2"===n&&"lg"===i||l?t="jpg":"v3"===n&&(t="webp"),(a?"".concat("https://lexica.art","/download"):"https://image.lexica.art")+"/".concat(s).concat(t?"_".concat(t):"","/").concat(r)}let o=e=>{let{prompt:t,imageId:n,appendId:r=!1}=e,i=(t=t.trim()).split(","),o=t;return(i.length&&(o=i[0].trim()),o.length>50&&(o=o.slice(0,50)),o)?o+(r?"-"+n:"")+".webp":n+".webp"},a=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"optimized",n=new FormData;n.append("file",e),console.log("Uploading...");let i=await r.Z.post("/api/get-upload-url").then(e=>e.data).then(async e=>{if(e.error)throw Error(e.error);return e});console.log("Got upload url",i.uploadURL);let o=await r.Z.post(i.uploadURL,n,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>e.data);if(!o.success)throw console.log("Upload error",o),Error("Image upload error");let a=o.result.variants.find(e=>-1!==e.indexOf(t))+"?type=.jpg";return console.log("Uploaded",a),a}},90166:function(e,t,n){n.d(t,{n:function(){return o}});var r=n(70165),i=n(55764);function o(e){let{mutationFn:t,optimistic:n}=e,o=(0,r.NL)();return(0,i.D)({mutationFn:t,onMutate:async e=>{let t=[];for(let i of n(e))if("queryKey"in i){var r;let{queryKey:e,updater:n}=i,a=!1;(null===(r=o.getQueryState(e))||void 0===r?void 0:r.fetchStatus)==="fetching"&&(await o.cancelQueries(e),a=!0);let l=o.getQueryData(e),s=()=>o.setQueryData(e,l),u=()=>o.invalidateQueries(e);o.setQueryData(e,n),t.push({rollback:s,invalidate:u,didCancelFetch:a})}else{let{getData:e,setData:n,updater:r}=i,o=e(),a=()=>n(o);n(r),t.push({rollback:a})}return{results:t}},onError:(e,t,n)=>{console.log("[onError] optimisticResults",null==n?void 0:n.results),(null==n?void 0:n.results)&&n.results.forEach((e,t)=>{let{rollback:n}=e;console.log("[onError] rolling back query ".concat(t)),n()})},onSettled:(e,t,n,r)=>{console.log("[onSettled] optimisticResults",null==r?void 0:r.results),(null==r?void 0:r.results)&&r.results.forEach((e,t)=>{let{didCancelFetch:n,invalidate:r}=e;n&&r&&(console.log("[onError] invalidating query ".concat(t)),r())})}})}}}]);