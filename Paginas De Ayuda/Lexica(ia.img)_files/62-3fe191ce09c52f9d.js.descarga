"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[62],{28925:function(e,t,a){a.d(t,{b:function(){return h},t:function(){return g}});var s=a(57437),r=a(2265),n=a(57042),l=a(97876),i=a(44348),o=a(19702),c=a(25137),d=a(16345),u=a(51937),p=a(3086);function m(e){let{showDelete:t}=e,{selectedImages:m,onClear:f,setEnabled:x}=g(),h=(0,r.useRef)(null),y=(0,r.useRef)(0),j=(0,r.useRef)(0),b=(0,r.useRef)(!1),[w,v]=(0,r.useState)(0),[N,D]=(0,r.useState)(!1),[C,S]=(0,r.useState)("idle"),[k,R]=(0,r.useState)("idle"),Z=(0,r.useRef)(null);(0,u.Z)(Z,()=>{D(!1)});let{mutateAsync:I}=(0,p.u)(),M=(0,r.useRef)(null),E=(0,r.useRef)(null),F=async()=>{S("pending"),h.current=Date.now();let e=m.map(e=>{let t=e.promptObj;if(!t)return null;let a=(0,o.tO)({prompt:t.prompt||"",imageId:e.id,appendId:!0});return{name:"lexica-download/".concat(a),url:(0,o.Jn)({id:e.id,size:"lg",forceJpg:!1,model:t.model})}}).filter(e=>e),t=e.map(e=>fetch(e.url).then(e=>e.blob()).then(e=>(y.current++,j.current=Math.floor(y.current/m.length*100),Date.now()-h.current>1e3&&j.current<30&&(b.current=!0),e)));E.current=setInterval(()=>{v(j.current)},100);try{let s=(await Promise.all(t)).map((t,a)=>({name:e[a].name,lastModified:new Date,input:t})),r=(await a.e(1562).then(a.bind(a,61562))).downloadZip,n=await r(s).blob(),l=document.createElement("a");l.href=URL.createObjectURL(n),l.download="lexica-download.zip",l.click(),l.remove();let i=Date.now()-h.current;setTimeout(()=>{S("complete"),M.current=setTimeout(()=>{S("idle")},3e3)},Math.max(1e3-i,0))}catch(e){console.error("error",e),setTimeout(()=>{S("error")},500)}finally{clearInterval(E.current)}},T=async()=>{R("pending"),h.current=Date.now();try{let e=m.map(e=>e.id);await I({ids:e});let t=Date.now()-h.current;setTimeout(()=>{R("complete"),M.current=setTimeout(()=>{D(!1),R("idle")},3e3)},Math.max(1e3-t,0))}catch(e){console.error("error",e),R("error")}};return(0,s.jsxs)("div",{className:"fixed z-50 top-0 left-0 w-full py-3 px-6 bg-indigo-600 text-white space-y-4 sm:space-y-0 sm:flex sm:items-center sm:justify-between bg-opacity-80 backdrop-blur-lg shadow-lg",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xl flex items-center",children:0===m.length?(0,s.jsx)(s.Fragment,{children:"Select images below"}):(0,s.jsxs)(s.Fragment,{children:[m.length," image",m.length>1&&"s"," selected",(0,s.jsx)("button",{className:"ml-3 underline text-sm",onClick:()=>{f()},children:"clear"})]})}),(0,s.jsx)("div",{className:"hidden sm:block text-xs mt-1 opacity-60",children:1e3===m.length?(0,s.jsx)(s.Fragment,{children:"Max selected. Download before selecting more."}):(0,s.jsx)(s.Fragment,{children:"Shift + click to select multiple"})})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-7",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsxs)("button",{onClick:()=>{F()},type:"button",disabled:0===m.length||"pending"===C||"complete"===C,className:"overflow-hidden relative min-w-[8rem] text-sm rounded-md group whitespace-nowrap flex-1 flex select-none cursor-pointer hover:brightness-110 bg-gradient-to-t from-indigo-900 via-indigo-900 to-indigo-900 drop-shadow items-center justify-center px-5 py-2.5 active:scale-95 transition-all",children:["\xa0",(0,s.jsx)("span",{className:(0,n.Z)("transition-all duration-500 w-full flex items-center justify-center space-x-2 absolute",{"translate-y-0 opacity-100":"idle"===C,"translate-y-8 opacity-0":"idle"!==C}),children:(0,s.jsx)("span",{children:"Download"})}),(0,s.jsxs)("span",{className:(0,n.Z)("transition-all duration-500 w-full flex items-center justify-center space-x-2 absolute",{"-translate-y-8 opacity-0":"idle"===C,"translate-y-0 opacity-100":"pending"===C,"translate-y-8 opacity-100":"complete"===C||"error"===C}),children:[(0,s.jsx)(c.$,{size:"md"}),b.current&&(0,s.jsxs)("span",{children:[Math.floor(w),"%"]})]}),(0,s.jsxs)("span",{className:(0,n.Z)("transition-all duration-500 w-full flex items-center justify-center space-x-2 absolute",{"-translate-y-8 opacity-0":"complete"!==C,"translate-y-0 opacity-100":"complete"===C}),children:[(0,s.jsx)(i.m,{className:"opacity-80"}),(0,s.jsx)("span",{children:"Complete"})]}),(0,s.jsx)("span",{className:(0,n.Z)("transition-all duration-500 w-full flex items-center justify-center space-x-2 absolute",{"-translate-y-8 opacity-0":"error"!==C,"translate-y-0 opacity-100":"error"===C}),children:(0,s.jsx)("span",{children:"Error. Retry?"})}),"\xa0"]}),t&&(0,s.jsx)(s.Fragment,{children:N?(0,s.jsxs)("button",{ref:Z,onClick:()=>{T()},type:"button",disabled:0===m.length||"pending"===k||"complete"===k,className:"overflow-hidden relative min-w-[9rem] text-sm rounded-md group whitespace-nowrap flex-1 flex select-none cursor-pointer hover:brightness-110 bg-gradient-to-t bg-red-800 drop-shadow items-center justify-center px-5 py-2.5 active:scale-95 transition-all",children:["\xa0",(0,s.jsx)("span",{className:(0,n.Z)("transition-all duration-500 w-full flex items-center justify-center space-x-2 absolute",{"translate-y-0 opacity-100":"idle"===k,"translate-y-8 opacity-0":"idle"!==k}),children:(0,s.jsx)("span",{children:"Confirm Delete"})}),(0,s.jsx)("span",{className:(0,n.Z)("transition-all duration-500 w-full flex items-center justify-center space-x-2 absolute",{"-translate-y-8 opacity-0":"idle"===k,"translate-y-0 opacity-100":"pending"===k,"translate-y-8 opacity-100":"complete"===k||"error"===k}),children:(0,s.jsx)(c.$,{size:"md"})}),(0,s.jsxs)("span",{className:(0,n.Z)("transition-all duration-500 w-full flex items-center justify-center space-x-2 absolute",{"-translate-y-8 opacity-0":"complete"!==k,"translate-y-0 opacity-100":"complete"===k}),children:[(0,s.jsx)(i.m,{className:"opacity-80"}),(0,s.jsx)("span",{children:"Complete"})]}),(0,s.jsx)("span",{className:(0,n.Z)("transition-all duration-500 w-full flex items-center justify-center space-x-2 absolute",{"-translate-y-8 opacity-0":"error"!==k,"translate-y-0 opacity-100":"error"===k}),children:(0,s.jsx)("span",{children:"Error. Retry?"})}),"\xa0"]},"confirm"):(0,s.jsxs)("button",{onClick:()=>{D(!0)},disabled:0===m.length||"pending"===k||"complete"===k,className:"overflow-hidden relative text-sm rounded-md group whitespace-nowrap flex-1 flex select-none cursor-pointer hover:brightness-110 bg-gradient-to-t from-indigo-900 via-indigo-900 to-indigo-900 drop-shadow items-center justify-center px-3 py-2.5 active:scale-95 transition-all",children:["\xa0",(0,s.jsx)(d.W,{}),"\xa0"]})})]}),(0,s.jsx)("button",{onClick:()=>{M.current&&clearTimeout(M.current),f(),x(!1)},type:"button",className:"text-sm opacity-60 hover:opacity-100 rounded-full bg-indigo-800 w-6 h-6 flex items-center justify-center absolute top-3 right-3 sm:static",children:(0,s.jsx)(l.q,{})})]})]})}let f=r.createContext(void 0),x={enabled:!1,setEnabled:e=>{},selectedImages:[],setSelectedImages:()=>{},isSelected:e=>!1,onSelect:e=>{},onDeselect:e=>{},onClear:()=>{}},h=e=>{let{images:t,showDelete:a,children:n}=e,[l,i]=(0,r.useState)(!1),[o,c]=(0,r.useState)([]),d=(0,r.useCallback)(e=>void 0!==o.find(t=>t.id===e),[o]),u=(0,r.useCallback)((e,a)=>{let s=[];if(a){let a=t.findIndex(t=>t.id===e);if(-1===a){console.error("Image not found");return}let r=-1;for(let e=0;e<a;e++){let a=t[e];o.find(e=>e.id===a.id)&&(r=e)}if(r>=0)for(let e=r+1;e<a;e++)s.push(t[e])}let r=t.find(t=>t.id===e);r&&s.push(r),c(e=>[...e,...s].slice(0,1e3))},[t,o,1e3]),p=(0,r.useCallback)(e=>{c(t=>t.filter(t=>t.id!==e))},[c]),h=(0,r.useCallback)(()=>{c([])},[c]),g=(0,r.useMemo)(()=>({enabled:l,setEnabled:i,selectedImages:o,setSelectedImages:c,isSelected:d,onSelect:u,onDeselect:p,onClear:h}),[l,i,o,d,u,p,h]),y=(0,r.useMemo)(()=>({...x,setEnabled:i}),[]),j=l?g:y;return(0,s.jsxs)(f.Provider,{value:j,children:[l&&(0,s.jsx)(m,{showDelete:a}),n]})},g=()=>{let e=(0,r.useContext)(f);return void 0===e?x:e}},3086:function(e,t,a){a.d(t,{u:function(){return i}});var s=a(24670),r=a(28925),n=a(90166),l=a(54829);function i(){let e=(0,s.useApertureState)(),{promptModal:t,setPromptModal:a}=(0,s.usePromptModal)(),i=(0,r.t)(),o=["prompts.infinitePrompts",{text:"",source:"history"}];return(0,n.n)({mutationFn:async e=>l.Z.post("/api/images/delete",e).then(e=>e.data),optimistic:s=>{let r=new Set(s.ids);return[{queryKey:o,updater:e=>{if(e)return{...e,pages:e.pages.map((e,t)=>({...e,images:e.images.filter(e=>!r.has(e.id)),prompts:e.prompts.map(e=>({...e,images:e.images.filter(e=>!r.has(e.id))})).filter(e=>e.images.length>0),count:0===t&&e.count?Math.max(0,e.count-s.ids.length):0}))}}},{getData:()=>t,setData:e=>a(e),updater:e=>{if(e)return{...e,prompt:{...e.prompt,images:e.prompt.images.filter(e=>!r.has(e.id))}}}},{getData:()=>e.imageRows,setData:t=>e.setState("imageRows",t),updater:e=>e.map(e=>({...e,images:e.images.filter(e=>!r.has(e.id))})).filter(e=>e.images.length>0)},{getData:()=>e.sources,setData:t=>e.setState("sources",t),updater:e=>e.filter(e=>!r.has(e.id))},{getData:()=>i.selectedImages,setData:e=>e&&i.setSelectedImages(e),updater:e=>e.filter(e=>!r.has(e.id))}]}})}}}]);