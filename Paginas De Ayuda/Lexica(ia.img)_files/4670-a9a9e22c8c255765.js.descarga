"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4670],{24670:function(e,t,n){n.r(t),n.d(t,{LoginProvider:function(){return M},PromptModalProvider:function(){return I},Providers:function(){return S},useApertureState:function(){return w},useLogin:function(){return N},useNumColumns:function(){return y},usePromptModal:function(){return E}});var r=n(57437),i=n(82868),o=n(82749),s=n(2265),a=n(24033),l=n(82157),d=n(54829),u=n(10938),c=n(70165),h=n(28285),m=n(58732),p=n(68592);let x=new u.S,f={prompt:"",promptId:null,negativePrompt:"",guidanceScale:6,enableHiresFix:!1,speed:null,enableCelebFix:!1,dimensionsIndex:5,model:"lexica-aperture-v5",imageRows:[],showSafetyWarning:null,hasFlaggedPrompt:!1,showAdvancedSettings:!1,pendingGenerations:[],bannedTerms:[],progressBarInView:!1,showUpgradeMessage:!1,showMembershipMessage:!1,showNoFreePlanMessage:!1,showMaxParallelMessage:!1,showNoMoreFastMessage:!1,showRequestErrorMessage:!1,showSlowCapHitMessage:!1,slowCapResetDate:null,showBannedMessage:null,sourceAction:"variation",sources:[],setState:()=>{}},v=s.createContext(void 0),g=e=>{let{children:t}=e,[n,i]=(0,s.useState)(f),a=(0,s.useCallback)((e,t)=>{i(n=>{let r=n.dimensionsIndex;if("model"===e&&"lexica-aperture-v3"===t&&"lexica-aperture-v3"!==n.model){let e=p.Ru.length-1,t=p.n7.length-1;r=Math.max(0,Math.min(Math.round(n.dimensionsIndex/t*e),e))}else if("model"===e&&"lexica-aperture-v3"!==t&&"lexica-aperture-v3"===n.model){let e=p.Ru.length-1,t=p.n7.length-1;r=Math.max(0,Math.min(Math.round(n.dimensionsIndex/e*t),t))}if("function"!=typeof t)return{...n,dimensionsIndex:r,[e]:t};{let i=n[e];return{...n,dimensionsIndex:r,[e]:t(i)}}})},[]);!function(e,t){let{status:n}=(0,o.useSession)(),{pendingGenerations:r,imageRows:i}=e,{data:a}=(0,h.a)(["pending-generations"],{queryFn:()=>(0,d.Z)("/api/generations/pending").then(e=>e.data),refetchOnWindowFocus:!1,notifyOnChangeProps:["data"],enabled:"authenticated"===n});a=(0,s.useMemo)(()=>{if((null==a?void 0:a.length)&&i)return a.filter(e=>-1===i.findIndex(t=>t.prompt.id===e.promptid))},[a,i]),(0,s.useEffect)(()=>{(null==a?void 0:a.length)&&t("pendingGenerations",e=>{let t=a.filter(t=>-1===e.findIndex(e=>e.requestId===t.requestId)).map(e=>({...e,poll:!0}));return[...e,...t]})},[a,t]);let l=r.filter(e=>e.poll).map(e=>e.requestId),{data:u}=(0,h.a)(["generations-poll",l],{queryFn:()=>(console.log("Polling for:",l),d.Z.get("/api/generations/poll?requestIds=".concat(l.join(","))).then(e=>e.data)),refetchInterval:3e3,refetchIntervalInBackground:!0,notifyOnChangeProps:["data"],enabled:l.length>0});(0,s.useEffect)(()=>{if(u){if(console.log("Poll response",u),u.didComplete.length){t("pendingGenerations",e=>e.filter(e=>-1===u.didComplete.findIndex(t=>t.requestId===e.requestId)));let n=u.completedData.filter(e=>e.images.length>0),r=u.completedData.filter(e=>0===e.images.length);if(r.length){var e;t("showSafetyWarning",(null===(e=r[0].prompt)||void 0===e?void 0:e.prompt)||"");return}n.length&&t("imageRows",e=>[...n,...e])}u.didError.length&&(t("showRequestErrorMessage",!0),t("pendingGenerations",e=>e.filter(e=>-1===u.didError.findIndex(t=>t.requestId===e.requestId))))}},[u,t])}(n,a);let l=(0,s.useMemo)(()=>({...n,setState:a}),[n,a]);return(0,r.jsx)(v.Provider,{value:l,children:t})},w=()=>{let e=(0,s.useContext)(v);if(void 0===e)throw Error("useApertureState must be used within ApertureContext.Provider");return e},b=s.createContext(void 0),j=e=>{let{children:t}=e,[n,i]=(0,s.useState)(null),o=(0,s.useMemo)(()=>({numColumns:n,setNumColumns:i}),[n,i]);return(0,r.jsx)(b.Provider,{value:o,children:t})},y=()=>{let e=(0,s.useContext)(b);if(void 0===e)throw Error("useNumColumns must be used within NumColumnsProvider");return e},P=s.createContext(void 0),M=e=>{let{children:t}=e,[n,i]=(0,s.useState)(),o=(0,s.useCallback)(e=>{i(e||window.location.href)},[i]),a=(0,s.useMemo)(()=>({loginCallbackUrl:n,setLoginCallbackUrl:o}),[n,o]);return(0,r.jsx)(P.Provider,{value:a,children:t})},N=()=>{let e=(0,s.useContext)(P);if(void 0===e)throw Error("useLogin must be used within LoginProvider");return e},C=s.createContext(void 0),I=e=>{let{children:t}=e,[n,i]=(0,s.useState)(),o=(0,s.useMemo)(()=>({promptModal:n,setPromptModal:i}),[n,i]);return(0,r.jsx)(C.Provider,{value:o,children:t})},E=()=>{let e=(0,s.useContext)(C);if(void 0===e)throw Error("usePromptModal must be used within PromptModalProvider");return e},S=e=>{let{children:t}=e,n=(0,a.useRouter)(),d=(0,a.usePathname)(),u=(0,s.useCallback)(e=>{e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement||("h"===e.key&&"/"!==d?(console.log("Home"),e.preventDefault(),n.push("/")):"g"===e.key&&"/aperture"!==d&&(console.log("Aperture"),e.preventDefault(),n.push("/aperture")))},[d,n]),h=(0,s.useMemo)(()=>({apiKey:"AggytNrYd94cDCAtxRNV",scriptUrlPattern:"https://lexica.art/1N9W2boF0qeVPfbR/pfBLwEG93xorirf8?apiKey=<apiKey>&version=<version>&loaderVersion=<loaderVersion>",endpoint:"https://lexica.art/1N9W2boF0qeVPfbR/Wmz9wKZDIDE8qYCh"}),[]);return(0,s.useEffect)(()=>(window.addEventListener("keydown",u),()=>{window.removeEventListener("keydown",u)}),[u]),(0,s.useEffect)(()=>{if(/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream){let e=document.querySelector("meta[name=viewport]");if(null!==e){let t=e.getAttribute("content"),n=/maximum\-scale=[0-9\.]+/g;null!==t&&(t=n.test(t)?t.replace(n,"maximum-scale=1.0"):[t,"maximum-scale=1.0"].join(", "),e.setAttribute("content",t))}}},[]),(0,r.jsx)("div",{children:(0,r.jsx)(l.vQ,{loadOptions:h,cacheTimeInSeconds:86400,cacheLocation:l.Xd.LocalStorage,children:(0,r.jsx)(i.pn,{children:(0,r.jsx)(o.SessionProvider,{refetchOnWindowFocus:!1,children:(0,r.jsx)(c.aH,{client:x,children:(0,r.jsx)(g,{children:(0,r.jsx)(j,{children:(0,r.jsx)(M,{children:(0,r.jsx)(I,{children:(0,r.jsx)(m.nP,{children:t})})})})})})})})})})}},68592:function(e,t,n){n.d(t,{NN:function(){return f},Ov:function(){return g},Ru:function(){return p},n:function(){return x},n7:function(){return m},td:function(){return v}});var r=n(57437),i=n(41158),o=n(75585),s=n(57042),a=n(62167),l=n(65251),d=n(2265),u=n(60523),c=n(40011),h=n(59699);let m=[[768,512],[704,512],[640,512],[576,512],[640,640],[512,576],[512,640],[512,704],[512,768]],p=[[1152,768],[1088,896],[1024,1024],[896,1088],[768,1152]],x=[[1728,576],[1664,576],[1600,640],[1536,640],[1472,704],[1408,704],[1344,704],[1344,768],[1280,768],[1216,832],[1152,832],[1152,896],[1088,896],[1088,960],[1024,960],[1024,1024],[960,1024],[960,1088],[896,1088],[896,1152],[832,1152],[832,1216],[768,1280],[768,1344],[704,1344],[704,1408],[704,1472],[640,1536],[640,1600],[576,1664],[576,1728]],f=[[1600,832],[1440,960],[1360,1120],[1280,1280],[1120,1360],[960,1440],[832,1600]],v=[[2048,1024],[1820,1024],[1707,1024],[1536,1024],[1434,1024],[1365,1024],[1280,1024],[1024,1024],[1024,1280],[1024,1365],[1024,1434],[1024,1536],[1024,1707],[1024,1820],[1024,2048]],g=e=>{let{className:t="",dimensionsIndex:n,setDimensionsIndex:g,disabled:w=!1,model:b}=e,j={"lexica-aperture":m,"lexica-aperture-v2":m,"lexica-aperture-v3":p,"lexica-aperture-v3.5":x,"lexica-aperture-v4":x,"lexica-aperture-v5":f,"experimental-v1":v}[b],y=j[n][0],P=j[n][1],M={"lexica-aperture":1,"lexica-aperture-v2":1,"lexica-aperture-v3":2/3,"lexica-aperture-v3.5":2/3,"lexica-aperture-v4":2/3,"lexica-aperture-v5":.5,"experimental-v1":.5}[b],[N,C]=(0,d.useState)(!1),I=(0,i.Z)("(max-width: 640px)")?window.innerWidth/2-45:16+512/4.5;return(0,r.jsxs)("div",{className:t,children:[(0,r.jsx)(a.M,{children:N&&!w&&(0,r.jsxs)(l.E.div,{className:"z-10  absolute flex pointer-events-none items-center justify-center bg-zinc-900 border border-opacity-50 border-zinc-700 rounded-md shadow-lg drop-shadow-md",style:{marginTop:64},initial:{x:I-y*M/4.5/2,width:y*M/4.5,height:P*M/4.5,scale:.9,opacity:1},exit:{x:I-y*M/4.5/2,width:y*M/4.5,height:P*M/4.5,scale:.9,opacity:0},animate:{x:I-y*M/4.5/2,width:y*M/4.5,height:P*M/4.5,scale:1,opacity:1},transition:{type:"spring",stiffness:1e3,damping:50},children:[(0,r.jsx)("div",{className:"absolute h-3 w-3 border-t-2 border-l-2 top-0  opacity-20 left-0 m-2"}),(0,r.jsx)("div",{className:"absolute h-3 w-3 border-t-2 border-r-2 top-0  opacity-20 right-0 m-2"}),(0,r.jsx)("div",{className:"absolute h-3 w-3 border-b-2 border-l-2  opacity-20 bottom-0 left-0 m-2"}),(0,r.jsx)("div",{className:"absolute h-3 w-3 border-b-2 border-r-2  opacity-20 bottom-0 right-0 m-2"}),(0,r.jsx)("div",{className:"flex flex-col items-center justify-center relative",children:(0,r.jsxs)("p",{className:"text-sm proportional-nums slashed-zero text-white",children:[j[n][0]," \xd7 ",j[n][1]]})})]})}),(0,r.jsxs)("div",{className:"select-none opacity-50 text-xs flex items-center justify-start mb-3",children:[(0,r.jsx)(u.A,{className:"mr-2 text-sm"}),(0,r.jsx)("p",{children:"Dimensions"})]}),(0,r.jsxs)("div",{className:(0,s.Z)("",{"opacity-40":w}),children:[(0,r.jsxs)(o.fC,{min:0,max:j.length-1,step:1,"aria-label":"Dimensions",value:[n],onValueChange:e=>g(e[0]),className:(0,s.Z)("w-full relative flex items-center select-none touch-none h-5",{"cursor-pointer":!w}),onPointerOver:()=>C(!0),onPointerOut:()=>C(!1),disabled:w,children:[(0,r.jsx)(o.fQ,{className:"w-full h-0.5 bg-black rounded-full relative",children:(0,r.jsx)(o.e6,{className:"absolute bg-indigo-600 rounded-full h-full"})}),(0,r.jsx)(o.bU,{className:(0,s.Z)("block w-4 h-4 bg-white shadow-md rounded-full focus:ring-8 hover:ring-4 hover:ring-indigo-500 focus:ring-indigo-500 hover:ring-opacity-30 focus:ring-opacity-30 focus:outline-none hover:bg-zinc-200 transition-all",{"cursor-not-allowed":w})})]}),(0,r.jsxs)("div",{className:"flex justify-between w-full  select-none mt-2 text-base",children:[(0,r.jsx)(c.L,{className:"opacity-40"}),(0,r.jsxs)("div",{className:"text-xs flex items-center transition-all text-zinc-200",style:{opacity:N&&!w?0:1},children:[j[n][0]," \xd7 ",j[n][1]]}),(0,r.jsx)(h.b,{className:"opacity-40"})]})]})]})}},58732:function(e,t,n){n.d(t,{iP:function(){return a},nP:function(){return s}});var r=n(57437),i=n(2265);let o=i.createContext({width:void 0,height:void 0}),s=e=>{let{children:t}=e,n=function(){let[e,t]=(0,i.useState)({width:void 0,height:void 0});return(0,i.useEffect)(()=>{function e(){t({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),e}();return(0,r.jsx)(o.Provider,{value:n,children:t})},a=()=>{let e=(0,i.useContext)(o);if(void 0===e)throw Error("useWindowSize must be used within WindowSizeProvider");return e}}}]);